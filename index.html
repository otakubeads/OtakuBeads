<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Otaku Beads | M3 Checkout</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    <style>
        :root { 
            --p: #6750A4; --on-p: #ffffff; --s: #FEF7FF; --sc: #F3EDF7; 
            --sec: #E8DEF8; --on-sec: #1D192B; --err: #B3261E; --surf: #ffffff;
            --spring: cubic-bezier(0.2, 0, 0, 1);
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Roboto', sans-serif; background: var(--s); color: #1C1B1F; overflow-x: hidden; }

        /* --- MAINTAINANCE BARRIER: GRID UI --- */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 16px; padding-bottom: 160px; }
        .card { background: var(--surf); border-radius: 24px; padding: 12px; display: flex; flex-direction: column; position: relative; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .card img { width: 100%; aspect-ratio: 1/1; border-radius: 16px; object-fit: cover; margin-bottom: 8px; }

        .btn { border: none; height: 44px; border-radius: 22px; font-weight: 700; cursor: pointer; transition: 0.2s; width: 100%; margin-top: 6px; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .btn-p { background: var(--p); color: white; }
        .btn-added { background: var(--sec); color: var(--on-sec); }

        /* --- MAINTAINANCE BARRIER: M3 CHECKOUT MENU --- */
        .bag-view { position: fixed; inset: 0; background: var(--s); z-index: 3000; transform: translateY(100%); transition: transform 0.4s var(--spring); display: flex; flex-direction: column; }
        .bag-view.active { transform: translateY(0); }
        
        /* M3 Header Design */
        .bag-header { display: flex; align-items: center; padding: 16px; background: var(--surf); border-bottom: 1px solid var(--sc); height: 72px; }
        .bag-header h2 { font-weight: 700; font-size: 20px; color: var(--on-sec); flex: 1; text-align: center; }

        /* M3 List Items */
        .bag-item { 
            display: flex; align-items: center; gap: 16px; margin: 8px 16px; 
            background: var(--surf); padding: 16px; border-radius: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02); transition: 0.2s;
        }
        .bag-item img { width: 64px; height: 64px; border-radius: 12px; object-fit: cover; }
        
        /* Refined Separated Quantity Controls */
        .qty-ctrl { display: flex; align-items: center; gap: 16px; background: var(--sc); padding: 4px 8px; border-radius: 16px; }
        .ctrl-btn { width: 36px; height: 36px; border-radius: 10px; border: none; background: var(--surf); color: var(--p); font-size: 18px; font-weight: 900; }
        .ctrl-btn:active { background: var(--p); color: white; transform: scale(0.9); }

        /* Anchored Footer Barrier */
        .bag-footer { 
            padding: 24px 24px calc(32px + env(safe-area-inset-bottom)); 
            background: var(--surf); border-radius: 32px 32px 0 0; 
            box-shadow: 0 -10px 30px rgba(0,0,0,0.1); z-index: 3100;
        }

        .price-text { color: var(--p); font-weight: 700; font-size: 14px; }
        .timer-pill { background: var(--p); color: white; padding: 8px 16px; border-radius: 12px; font-weight: 900; position: fixed; top: 15px; left: 50%; transform: translateX(-50%); z-index: 1200; box-shadow: 0 4px 10px rgba(103,80,164,0.3); }
    </style>
</head>
<body>

    <div id="t-pill" class="timer-pill">0D 00H 00M 00S</div>

    <header style="display: flex; align-items: center; padding: 60px 16px 16px;">
        <span class="material-symbols-outlined" style="color:var(--p)">menu</span>
        <img src="logo.jpg" style="width:40px; height:40px; border-radius:50%; margin: 0 12px;" onerror="this.src='logo.jpg'">
        <span style="font-weight: 900; font-size: 22px; color: var(--p);">Otaku Beads</span>
    </header>

    <main class="grid" id="grid-barrier"></main>

    <button style="position:fixed; bottom:24px; left:24px; right:24px; height:64px; background:var(--p); color:white; border-radius:20px; border:none; font-weight:900; z-index:1001; box-shadow: 0 8px 20px rgba(103,80,164,0.3);" onclick="MODULE_UI.toggleBag(true)">
        Review Bag (<span id="count-barrier">0</span>)
    </button>

    <div id="bag-barrier" class="bag-view">
        <div class="bag-header">
            <button onclick="MODULE_UI.toggleBag(false)" style="background:none; border:none"><span class="material-symbols-outlined">close</span></button>
            <h2>Review Bag</h2>
            <button onclick="MODULE_CORE.clear()" style="color:var(--err); background:none; border:none; font-weight:700; font-size: 12px;">CLEAR</button>
        </div>
        
        <div id="bag-list-barrier" style="flex:1; overflow-y:auto; padding-top: 8px;"></div>
        
        <div class="bag-footer">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: 700;">
                <span style="opacity: 0.6;">Total Estimate:</span>
                <span id="total-price" style="font-size: 24px; color: var(--p);">R 0.00</span>
            </div>
            <button class="btn btn-p" style="height:60px; font-size: 16px;" onclick="MODULE_CORE.checkout()">Confirm on WhatsApp</button>
        </div>
    </div>

    <script>
        const MODULE_CORE = (() => {
            const deadline = new Date("Jan 31, 2026 23:59:59").getTime();
            const prices = { promo: 45, standard: 65 };
            let cart = JSON.parse(localStorage.getItem('otaku_cart')) || [];
            return {
                getCart: () => cart,
                getDeadline: () => deadline,
                getPrice: (id) => id <= 2 ? prices.promo : prices.standard,
                add(id) { cart.push(id); this.save(); },
                remove(id) { const i = cart.lastIndexOf(id); if(i>-1) cart.splice(i,1); this.save(); },
                clear() { if(confirm("Clear bag?")) { cart=[]; this.save(); MODULE_UI.toggleBag(false); } },
                save() { localStorage.setItem('otaku_cart', JSON.stringify(cart)); document.getElementById('count-barrier').innerText = cart.length; MODULE_RENDERER.refresh(); },
                checkout() {
                    const counts = cart.reduce((a,c)=>{ a[c]=(a[c]||0)+1; return a; }, {});
                    let m = "Otaku Beads Order:%0A";
                    Object.keys(counts).forEach(id => m += `- Design #${id} (x${counts[id]})%0A`);
                    window.open(`https://wa.me/27XXXXXXXXX?text=${m}`);
                }
            };
        })();

        const MODULE_RENDERER = (() => {
            return {
                refresh() { this.grid(); this.bag(); },
                grid() {
                    const g = document.getElementById('grid-barrier');
                    const counts = MODULE_CORE.getCart().reduce((a,c)=>{ a[c]=(a[c]||0)+1; return a; }, {});
                    let h = "";
                    for(let i=1; i<=28; i++) {
                        const q = counts[i] || 0;
                        if(i === 26) {
                            h += `<div class="card"><img src="26.jpg" onerror="this.src='logo.jpg'"><div style="font-weight:900; font-size: 14px;">#26</div><button class="btn" disabled style="background:var(--sc); color:var(--out)">Coming Soon</button></div>`;
                        } else {
                            h += `<div class="card">
                                ${i<=2?'<div style="position:absolute;top:16px;left:16px;background:var(--err);color:white;padding:4px 8px;border-radius:8px;font-size:10px;font-weight:900;">PROMO</div>':''}
                                <img src="${i}.jpg" onerror="this.src='logo.jpg'">
                                <div style="font-weight:900; font-size:14px;">Design #${i}</div>
                                <div class="price-text">R ${MODULE_CORE.getPrice(i)}.00</div>
                                <button class="btn ${q>0?'btn-added':'btn-p'}" onclick="MODULE_CORE.add(${i})">${q>0?q+' Added':'Add'}</button>
                            </div>`;
                        }
                    }
                    g.innerHTML = h;
                },
                bag() {
                    const list = document.getElementById('bag-list-barrier');
                    const counts = MODULE_CORE.getCart().reduce((a,c)=>{ a[c]=(a[c]||0)+1; return a; }, {});
                    let total = 0;
                    list.innerHTML = Object.keys(counts).map(id => {
                        const p = MODULE_CORE.getPrice(id);
                        total += (p * counts[id]);
                        return `<div class="bag-item">
                            <img src="${id}.jpg" onerror="this.src='logo.jpg'">
                            <div style="flex:1;"><div style="font-weight:700;">#${id}</div><div class="price-text">R ${p}.00</div></div>
                            <div class="qty-ctrl">
                                <button class="ctrl-btn" onclick="MODULE_CORE.remove(${id})">â€”</button>
                                <span style="font-weight:900; min-width:20px; text-align:center;">${counts[id]}</span>
                                <button class="ctrl-btn" onclick="MODULE_CORE.add(${id})">+</button>
                            </div>
                        </div>`;
                    }).join('') || '<p style="text-align:center; padding:40px; opacity:0.5;">Bag is empty</p>';
                    document.getElementById('total-price').innerText = `R ${total}.00`;
                }
            };
        })();

        const MODULE_UI = { toggleBag(s) { document.getElementById('bag-barrier').classList.toggle('active', s); document.body.style.overflow = s?'hidden':'auto'; } };

        (function() {
            MODULE_RENDERER.refresh();
            setInterval(() => {
                const diff = MODULE_CORE.getDeadline() - Date.now();
                if(diff <= 0) return;
                const d = Math.floor(diff/86400000), h = Math.floor((diff%86400000)/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
                document.getElementById('t-pill').innerText = `${d}D ${h}H ${m}M ${s}S LEFT`;
            }, 1000);
        })();
    </script>
</body>
</html>
