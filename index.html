<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otaku Beads | Self-Healing Store</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0..1,0" rel="stylesheet">
    <style>
        :root { --p: #B3261E; --s: #F7F2FA; --c: #FFFFFF; --on-s: #1D1B20; --bez: cubic-bezier(0.2, 0, 0, 1); }
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body { font-family: 'Google Sans', sans-serif; background: var(--s); color: var(--on-s); }
        header { margin: 8px 16px; padding: 4px 12px; height: 56px; background: #EEE8F4; border-radius: 28px; display: flex; align-items: center; gap: 12px; position: sticky; top: 8px; z-index: 1000; }
        #search-input { background: transparent; border: none; font-family: inherit; font-size: 16px; width: 100%; color: #49454F; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 16px; padding-bottom: 120px; }
        .card { background: var(--c); border-radius: 24px; padding: 8px; border: 1px solid #E7E0EC; }
        .card img { width: 100%; aspect-ratio: 1; border-radius: 18px; object-fit: cover; }
        .sheet { position: fixed; inset: 0; z-index: 9999; transform: translateY(100%); background: var(--s); transition: 0.5s var(--bez); border-radius: 28px 28px 0 0; padding: 24px; text-align: center; }
        .pill-btn { background: white; border: 1px solid #79747E; padding: 12px 24px; border-radius: 24px; font-weight: 500; margin: 8px 0; display: block; width: 100%; cursor: pointer; }
        #scrim { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 9000; display: none; backdrop-filter: blur(4px); }
    </style>
</head>
<body>
    <div id="scrim" onclick="CORE.UI.close()"></div>
    <div id="app-root">
        <header id="main-header">
            <span class="material-symbols-rounded">menu</span>
            <input type="text" id="search-input" placeholder="Search beads, keychains..." oninput="CORE.LOGIC.search(this.value)">
            <button class="profile-trigger" style="width:32px;height:32px;border-radius:50%;background:#EADDFF;border:none;overflow:hidden;" onclick="CORE.UI.open('auth')">
                <div id="h-avatar"><span class="material-symbols-rounded">account_circle</span></div>
            </button>
        </header>
        <main class="grid" id="main-grid"></main>
    </div>

    <div id="auth-sheet" class="sheet"><div id="s-avatar"></div><h3 id="user-name">Hi, Guest!</h3><div id="g-zone"></div><button class="pill-btn" onclick="CORE.UI.close()">Continue</button></div>
    <div id="paxi-sheet" class="sheet"><h2>Bag</h2><div id="bag-list"></div></div>

    <script>
        const CATALOG = Array.from({length: 28}, (_, i) => ({ id: i+1, type: i%2===0?"Bead":"Keychain", name: `Item #${i+1}`, price: 20 }));

        const CORE = {
            bag: [],
            // SELF-HEALING REPAIR KIT
            REPAIR() {
                if(!document.getElementById('main-header')) {
                    console.warn("Brain detected UI breakage. Restoring...");
                    location.reload(); 
                }
            },
            AUTH: {
                heartbeat() {
                    try {
                        const u = JSON.parse(localStorage.getItem('ob_auth') || 'null');
                        if (u) {
                            const img = `<img src="${u.picture}" style="width:100%">`;
                            document.getElementById('h-avatar').innerHTML = img;
                            document.getElementById('user-name').innerText = `Hi, ${u.given_name}!`;
                        }
                    } catch(e) { console.error("Handshake interrupted. Stabilizing..."); }
                }
            },
            UI: {
                open(id) { document.getElementById(id+'-sheet').style.transform = 'translateY(0)'; document.getElementById('scrim').style.display='block'; },
                close() { document.querySelectorAll('.sheet').forEach(s=>s.style.transform='translateY(100%)'); document.getElementById('scrim').style.display='none'; },
                render(list = CATALOG) {
                    const g = document.getElementById('main-grid');
                    g.innerHTML = list.map(p => `
                        <div class="card">
                            <img src="${p.id===26?'Logo.jpg':p.id+'.jpg'}" onerror="this.src='Logo.jpg'">
                            <div style="display:flex;justify-content:space-between;padding:8px 0;"><b>${p.type} #${p.id}</b><span>R${p.price}</span></div>
                            <button class="pill-btn" style="background:#EADDFF;border:none;" ${p.id===26?'disabled':''}>${p.id===26?'Soon':'Add'}</button>
                        </div>
                    `).join('');
                }
            },
            LOGIC: {
                search(q) {
                    const filtered = CATALOG.filter(p => p.type.toLowerCase().includes(q.toLowerCase()) || p.id.toString().includes(q));
                    CORE.UI.render(filtered);
                }
            }
        };

        window.onload = () => {
            CORE.UI.render();
            // START HEARTBEAT & WATCHDOG
            setInterval(() => {
                CORE.AUTH.heartbeat();
                CORE.REPAIR();
            }, 1000);
        };
    </script>
</body>
</html>
