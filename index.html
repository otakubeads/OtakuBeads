<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Otaku Beads | PAXI Delivery</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
    <style id="dynamic-theme"></style>
    <style>
        :root { --spring: cubic-bezier(0.2, 0, 0, 1); }
        body.lock-scroll { overflow: hidden; height: 100vh; }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; margin: 0; padding: 0; transition: all 0.4s var(--spring); }
        body { font-family: 'Google Sans', sans-serif; background: var(--md-sys-color-surface); color: var(--md-sys-color-on-surface); }

        .container { max-width: 1400px; margin: 0 auto; width: 100%; }
        
        /* Navigation Pages */
        .page { position: fixed; inset: 0; background: var(--md-sys-color-surface); z-index: 4000; transform: translateX(100%); transition: transform 0.5s var(--spring); overflow-y: auto; }
        .page.active { transform: translateX(0); }

        /* PAXI Branding & UI */
        .paxi-hero { background: #005eb8; color: white; padding: 40px 24px; border-radius: 0 0 40px 40px; text-align: center; }
        .guide-card { background: var(--md-sys-color-surface-container-low); padding: 20px; border-radius: 24px; margin: 12px 24px; display: flex; gap: 16px; align-items: center; border: 1px solid var(--md-sys-color-outline-variant); }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; padding: 16px; padding-bottom: 140px; }
        .sheet { position: fixed; inset: 0; z-index: 3000; transform: translateY(115%); transition: transform 0.5s var(--spring); background: var(--md-sys-color-surface-container-highest); display: none; flex-direction: column; border-radius: 32px 32px 0 0; }
        .sheet.active { transform: translateY(0); display: flex; }
        .card { background: var(--md-sys-color-surface-container-low); border-radius: 24px; padding: 12px; position: relative; opacity: 0; transform: translateY(20px); }
        .card.reveal { opacity: 1; transform: translateY(0); }
        .card img { width: 100%; aspect-ratio: 1/1; border-radius: 18px; object-fit: cover; }
        .btn { border: none; height: 48px; border-radius: 14px; font-weight: 700; width: 100%; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); }
        .btn-tonal { background: var(--md-sys-color-secondary-container); color: var(--md-sys-color-on-secondary-container); }
        #bag-fab { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); width: calc(100% - 48px); max-width: 400px; height: 72px; background: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); border-radius: 24px; border: none; font-weight: 700; font-size: 18px; z-index: 1000; box-shadow: var(--md-sys-elevation-4); }
        #scrim { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 2500; opacity: 0; pointer-events: none; backdrop-filter: blur(4px); }
        #scrim.active { opacity: 1; pointer-events: auto; }
        .stepper { display: flex; align-items: center; background: var(--md-sys-color-surface-container-high); border-radius: 12px; padding: 4px; gap: 12px; }
        .step-btn { width: 32px; height: 32px; border-radius: 8px; border: none; background: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); font-weight: 900; }
    </style>
</head>
<body>
    <div id="scrim" onclick="MODULE_UI.toggleBag(false)"></div>

    <div class="container">
        <header style="padding: 24px; display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <img src="logo.jpg" style="width:48px; height:48px; border-radius:12px;" onerror="this.src='logo.jpg'">
                <h1 style="font-size: 24px; font-weight: 700;">Otaku Beads</h1>
            </div>
            <div style="display: flex; gap: 8px;">
                <button class="btn-tonal" style="width:44px; height:44px; border-radius:12px;" onclick="MODULE_UI.togglePage('paxi-page', true)">
                    <span class="material-symbols-rounded">local_shipping</span>
                </button>
                <button class="btn-tonal" style="width:44px; height:44px; border-radius:12px;" onclick="THEME_ENGINE.toggle()">
                    <span class="material-symbols-rounded">brightness_auto</span>
                </button>
            </div>
        </header>

        <main class="grid" id="main-grid"></main>
    </div>

    <div id="paxi-page" class="page">
        <div style="padding: 16px 24px; position: sticky; top: 0; background: var(--md-sys-color-surface); z-index: 10;">
            <button class="btn-tonal" style="width:44px; height:44px; border-radius:22px;" onclick="MODULE_UI.togglePage('paxi-page', false)">
                <span class="material-symbols-rounded">arrow_back</span>
            </button>
        </div>
        
        <div class="paxi-hero">
            <h2 style="font-size: 28px; margin-bottom: 8px;">PAXI Store Delivery</h2>
            <p style="opacity: 0.9;">Collect from any PEP, Shoe City or Tekkie Town</p>
        </div>

        <div class="guide-card">
            <span class="material-symbols-rounded" style="color:#005eb8; font-size:32px;">location_on</span>
            <div>
                <h3 style="font-size:16px;">Step 1: Choose Store</h3>
                <p style="font-size: 14px; opacity: 0.7;">Find your nearest PEP store code (e.g. PEP 1234).</p>
            </div>
        </div>

        <div class="guide-card">
            <span class="material-symbols-rounded" style="color:#005eb8; font-size:32px;">payments</span>
            <div>
                <h3 style="font-size:16px;">Step 2: Payment</h3>
                <p style="font-size: 14px; opacity: 0.7;">R60 (7-9 days) or R100 (3-5 days). Pay via EFT/Capitec.</p>
            </div>
        </div>

        <div class="guide-card">
            <span class="material-symbols-rounded" style="color:#005eb8; font-size:32px;">sms</span>
            <div>
                <h3 style="font-size:16px;">Step 3: Collect</h3>
                <p style="font-size: 14px; opacity: 0.7;">You'll get an SMS with a PIN when it's ready to collect.</p>
            </div>
        </div>
    </div>

    <button id="bag-fab" onclick="MODULE_UI.toggleBag(true)">Bag (<span id="bag-count">0</span>)</button>

    <div id="bag-sheet" class="sheet">
        <div style="height: 4px; width: 32px; background: var(--md-sys-color-outline); border-radius: 2px; margin: 12px auto; opacity: 0.2;"></div>
        <div style="padding: 12px 20px; display: flex; align-items: center; justify-content: space-between;">
            <button class="btn-tonal" style="width:40px; height:40px; border-radius:20px; border:none;" onclick="MODULE_UI.toggleBag(false)"><span class="material-symbols-rounded">close</span></button>
            <h2 style="font-size: 20px; font-weight: 700;">Review Bag</h2>
            <button onclick="MODULE_CORE.clear()" style="background:none; border:none; color:var(--md-sys-color-error); font-weight:700;">CLEAR</button>
        </div>
        <div id="bag-items" style="flex: 1; overflow-y: auto; padding: 16px;"></div>
        <div style="padding: 24px; background: var(--md-sys-color-surface-container-high); border-radius: 32px 32px 0 0;">
            <div style="display:flex; justify-content: space-between; margin-bottom: 20px;">
                <span style="opacity:0.7">Total (excl. PAXI)</span>
                <span id="bag-total" style="font-size: 24px; font-weight: 900; color: var(--md-sys-color-primary);">R 0.00</span>
            </div>
            <button class="btn btn-primary" style="height: 64px; border-radius: 20px;" onclick="MODULE_CORE.checkout()">Confirm on WhatsApp</button>
        </div>
    </div>

    <script>
        const THEME_ENGINE = (() => {
            const p = {
                light: { primary: "#6750A4", onPrimary: "#FFFFFF", surface: "#FEF7FF", onSurface: "#1D1B20", primaryContainer: "#EADDFF", onPrimaryContainer: "#21005D", secondaryContainer: "#E8DEF8", onSecondaryContainer: "#1D192B", surfaceContainerLow: "#F7F2FA", surfaceContainerHigh: "#ECE6F0", surfaceContainerHighest: "#E6E0E9", outlineVariant: "#CAC4D0" },
                dark: { primary: "#D0BCFF", onPrimary: "#381E72", surface: "#141218", onSurface: "#E6E1E5", primaryContainer: "#4F378B", onPrimaryContainer: "#EADDFF", secondaryContainer: "#4A4458", onSecondaryContainer: "#E8DEF8", surfaceContainerLow: "#1D1B20", surfaceContainerHigh: "#2B2930", surfaceContainerHighest: "#332F37", outlineVariant: "#44474F" }
            };
            let mode = localStorage.getItem('theme_mode') || 'auto';
            return {
                apply() {
                    const isDark = mode === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : mode === 'dark';
                    const t = isDark ? p.dark : p.light;
                    let css = `:root {`;
                    for(let k in t) css += `--md-sys-color-${k.replace(/[A-Z]/g, m=>"-"+m.toLowerCase())}: ${t[k]};`;
                    css += `}`; document.getElementById('dynamic-theme').innerHTML = css;
                },
                toggle() { mode = (mode === 'auto' ? 'light' : (mode === 'light' ? 'dark' : 'auto')); localStorage.setItem('theme_mode', mode); this.apply(); }
            };
        })();

        const MODULE_CORE = (() => {
            let cart = JSON.parse(localStorage.getItem('otaku_v15')) || [];
            return {
                getCart: () => cart,
                getPrice: (id) => id <= 2 ? 45 : 65,
                add(id) { cart.push(id); this.save(); },
                remove(id) { const i = cart.lastIndexOf(id); if(i>-1) cart.splice(i,1); this.save(); },
                clear() { if(confirm("Empty Bag?")) { cart=[]; this.save(); MODULE_UI.toggleBag(false); } },
                save() { localStorage.setItem('otaku_v15', JSON.stringify(cart)); document.getElementById('bag-count').innerText = cart.length; MODULE_RENDERER.refresh(true); },
                checkout() {
                    const counts = cart.reduce((a,c)=>{ a[c]=(a[c]||0)+1; return a; }, {});
                    let total = 0, m = "ðŸšš *Otaku Beads Order (PAXI)* ðŸšš%0A%0A";
                    Object.keys(counts).forEach(id => {
                        const sub = this.getPrice(id) * counts[id]; total += sub;
                        m += `â–ªï¸ *Design #${id}* x${counts[id]} (R${sub})%0A`;
                    });
                    m += `%0AðŸ’° *Items Total: R${total}.00*`;
                    m += `%0A%0AðŸ“ *Delivery:* I would like PAXI delivery. My nearest PEP store/code is: [Enter Store Here]`;
                    window.open(`https://wa.me/27XXXXXXXXX?text=${encodeURIComponent(m)}`);
                }
            };
        })();

        const MODULE_RENDERER = (() => {
            const obs = new IntersectionObserver((es) => es.forEach(e => { if(e.isIntersecting) e.target.classList.add('reveal'); }), { threshold: 0.1 });
            return {
                refresh(k) { this.grid(k); this.bag(); },
                grid(k) {
                    const g = document.getElementById('main-grid');
                    const counts = MODULE_CORE.getCart().reduce((a,c)=>{ a[c]=(a[c]||0)+1; return a; }, {});
                    let h = "";
                    for(let i=1; i<=28; i++) {
                        const q = counts[i] || 0;
                        if(i === 26) h += `<div class="card reveal" style="opacity:0.5; filter:grayscale(1);"><img src="26.jpg" onerror="this.src='logo.jpg'"><div style="font-weight:700; margin-top:8px">#26</div><button class="btn btn-tonal" style="margin-top:10px; pointer-events:none;" disabled>Coming Soon</button></div>`;
                        else h += `<div class="card ${k?'reveal':''}">
                            <img src="${i}.jpg" onerror="this.src='logo.jpg'">
                            <div style="font-weight:700; margin-top:8px">Design #${i}</div>
                            <div style="color:var(--md-sys-color-primary); font-weight:900;">R ${MODULE_CORE.getPrice(i)}.00</div>
                            <button class="btn ${q>0?'btn-tonal':'btn-primary'}" style="margin-top:12px" onclick="MODULE_CORE.add(${i})">${q>0?q+' in Bag':'Add'}</button>
                        </div>`;
                    }
                    g.innerHTML = h; document.querySelectorAll('.card').forEach(c => obs.observe(c));
                },
                bag() {
                    const list = document.getElementById('bag-items');
                    const counts = MODULE_CORE.getCart().reduce((a,c)=>{ a[c]=(a[c]||0)+1; return a; }, {});
                    let total = 0;
                    list.innerHTML = Object.keys(counts).map(id => {
                        total += (MODULE_CORE.getPrice(id) * counts[id]);
                        return `<div style="display:flex; align-items:center; gap:12px; margin-bottom:12px; background:var(--md-sys-color-surface-container-low); padding:10px; border-radius:16px;">
                            <img src="${id}.jpg" style="width:44px; height:44px; border-radius:8px;" onerror="this.src='logo.jpg'">
                            <div style="flex:1; font-weight:700;">#${id}</div>
                            <div class="stepper">
                                <button class="step-btn" onclick="MODULE_CORE.remove(${id})">âˆ’</button>
                                <span style="font-weight:900; min-width:14px; text-align:center;">${counts[id]}</span>
                                <button class="step-btn" onclick="MODULE_CORE.add(${id})">+</button>
                            </div>
                        </div>`;
                    }).join('') || '<div style="text-align:center; opacity:0.3; padding:40px;">Empty</div>';
                    document.getElementById('bag-total').innerText = `R ${total}.00`;
                }
            };
        })();

        const MODULE_UI = { 
            toggleBag(s) { 
                const sheet = document.getElementById('bag-sheet');
                const scrim = document.getElementById('scrim');
                if(s) { sheet.style.display = "flex"; setTimeout(() => { sheet.classList.add('active'); scrim.classList.add('active'); }, 10); document.body.classList.add('lock-scroll'); }
                else { sheet.classList.remove('active'); scrim.classList.remove('active'); document.body.classList.remove('lock-scroll'); setTimeout(() => { sheet.style.display = "none"; }, 500); }
            },
            togglePage(id, s) {
                document.getElementById(id).classList.toggle('active', s);
                if(s) document.body.classList.add('lock-scroll');
                else document.body.classList.remove('lock-scroll');
            }
        };

        (() => { THEME_ENGINE.apply(); MODULE_RENDERER.refresh(); })();
    </script>
</body>
</html>
